language: java
jdk: oraclejdk8
install: true

cache:
  directories:
  - $HOME/.m2

before_install:
  - ./scripts/npm-settings.sh
  - ./scripts/maven-settings.sh

before_deploy:
  - export PATH=$PATH:$HOME/.local/bin

script:
  - mvn -U -s data/settings.xml test

deploy:
  - provider: script
    skip_cleanup: true
    script: mvn package deploy -DciBuildNumber=${TRAVIS_BUILD_NUMBER}
    on:
      branch: master

  - provider: script
    skip_cleanup: true
    script: scripts/deploy.sh
    on:
      tags: true
